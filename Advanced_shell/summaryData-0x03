#!/bin/bash

# Define the directory where the PokÃ©mon JSON files are stored
POKEMON_DIR="."

# Output CSV file
OUTPUT_CSV="pokemon_report.csv"

# Initialize variables to calculate the averages
total_height=0
total_weight=0
pokemon_count=0

# Create or overwrite the CSV file and add the header
echo "Name,Height( meters),Weight( kg)" > "$OUTPUT_CSV"

# Loop through each JSON file in the directory
for pokemon_file in $POKEMON_DIR/*.json; do
    # Extract the name, height, and weight using jq
    name=$(jq -r '.name' "$pokemon_file")
    height=$(jq -r '.height' "$pokemon_file")
    weight=$(jq -r '.weight' "$pokemon_file")

    # Convert height and weight to meters and kilograms (divide by 10)
    formatted_height=$(echo "$height / 10" | bc -l)
    formatted_weight=$(echo "$weight / 10" | bc -l)

    # Append the data to the CSV file
    echo "$name,$formatted_height,$formatted_weight" >> "$OUTPUT_CSV"

    # Update the total height and weight for calculating the averages
    total_height=$(echo "$total_height + $formatted_height" | bc -l)
    total_weight=$(echo "$total_weight + $formatted_weight" | bc -l)
    pokemon_count=$((pokemon_count + 1))
done

# Calculate the averages using awk
average_height=$(echo "$total_height / $pokemon_count" | bc -l)
average_weight=$(echo "$total_weight / $pokemon_count" | bc -l)

# Add the averages to the report
echo "Average Height (meters),$average_height" >> "$OUTPUT_CSV"
echo "Average Weight (kg),$average_weight" >> "$OUTPUT_CSV"

# Print success message
echo "Report generated: $OUTPUT_CSV"
