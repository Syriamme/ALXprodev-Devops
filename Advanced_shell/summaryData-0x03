#!/bin/bash

# Directory where the Pokémon JSON files are stored (make sure to set this correctly)
POKEMON_DIR="./"

# Output CSV file
OUTPUT_CSV="pokemon_summary.csv"

# Temporary files to store heights and weights for average calculation
TEMP_HEIGHTS="heights.txt"
TEMP_WEIGHTS="weights.txt"

# Initialize CSV file with headers
echo "Name,Height,Weight" > "$OUTPUT_CSV"

# Loop through all the JSON files in the directory
for json_file in "$POKEMON_DIR"*.json; do
    # Extract the Pokémon name, height, and weight using jq
    name=$(jq -r '.name' "$json_file")
    height=$(jq -r '.height' "$json_file")
    weight=$(jq -r '.weight' "$json_file")

    # Add the extracted data to the CSV file
    echo "$name,$height,$weight" >> "$OUTPUT_CSV"

    # Save height and weight for calculating averages later
    echo "$height" >> "$TEMP_HEIGHTS"
    echo "$weight" >> "$TEMP_WEIGHTS"
done

# Calculate average height and weight using awk
average_height=$(awk '{ total += $1; count++ } END { print total / count }' "$TEMP_HEIGHTS")
average_weight=$(awk '{ total += $1; count++ } END { print total / count }' "$TEMP_WEIGHTS")

# Append the averages to the CSV file
echo "Average,$average_height,$average_weight" >> "$OUTPUT_CSV"

# Clean up temporary files
rm "$TEMP_HEIGHTS" "$TEMP_WEIGHTS"

echo "Report generated: $OUTPUT_CSV"
